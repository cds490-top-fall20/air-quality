---
title: "App Name Here"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    source_code: "https://github.com/cds490-top-fall20/air-quality"
runtime: shiny
---

```{r global, include=FALSE}
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(shiny))
suppressPackageStartupMessages(library(leaflet))
suppressPackageStartupMessages(library(sf))
suppressPackageStartupMessages(library(reshape2))
suppressPackageStartupMessages(library(leafpop))
suppressPackageStartupMessages(library(DT))
suppressPackageStartupMessages(library(flexdashboard))

full_data <- read_rds("../data/processed/counties_mapping_data_simplified.rds")# %>% 
#  filter(
#    state_name == "Virginia"
#  )
```


Map
===========

Inputs {.sidebar}
-----------------------------------------------------------------------

### Customize

```{r}

selectInput("State", "Choose a state:",
      full_data$state_name
    )

map_data <- reactive({
  filter(
  full_data,
  state_name == input$State
  )
}
)
```


```{r}
 selectInput(
   "Grade",
   "What grade would you like to View?",
   list(
     "Pollutant Grade",
     "Ozone Grade",
     "Annual Pass/Fail"
     ),
   selected = "Pollutant Grade"
   )
```


**Optional overlays**

```{r}
checkboxInput("inputId1", "Aiports", value = FALSE, width = NULL)
checkboxInput("inputId2", "Ports", value = FALSE, width = NULL)
checkboxInput("inputId", "Show metro areas", value = FALSE, width = NULL)
```



Row 1 {data-height=650}
-----------------------------------------------------------------------

### Map

```{r}
renderLeaflet(
  {
    factpal <- colorFactor(c("yellow", "green"), map_data()$`Pollutant Grade`)
    
    leaflet(map_data()) %>% 
      addTiles %>%
      addProviderTiles("SafeCast") %>% 
      addPolygons(
        # data = shape,
        label = ~county_name,
        fillColor = ~ factpal(map_data()$`Pollutant Grade`),
        # layerId = ~COUNTYNS,
        opacity = 1,
        weight = 1,
        color = "white",
        dashArray = "3",
        fillOpacity = 0.5,
        popup = paste(
          "County:", map_data()$county_name,"<br>",
          "Selected Grade:", map_data()[[input$Grade]] ,"<br>",
          "Amount of People Who Commute In:", map_data()$commute_into,"<br>",
          "Amount of People who Commute Out:", map_data()$commute_out,"<br>",
          "Amount of People who Commute Within:", map_data()$commute_within
          ),
        highlight = highlightOptions(
          weight = 5,
          color = "#666",
          dashArray = "",
          fillOpacity = 0.7,
          bringToFront = TRUE
          )
        ) %>% 
      addLegend(
        pal = factpal, 
        values = ~`Pollutant Grade`, 
        opacity = 0.7, 
        title = NULL,
        position = "bottomright"
        )
    }
  )
```


Row 2 {data-height=350}
-------


### <Name of Information Box>
    
Possible information to go here:

* county grades

* transportation emission statistics

* housing information

* commuting information
    
### Another box

Ideas for content:

* Glossary/definitions?
* About the dashboard/ about us
* Another visualization



Compare
========

Inputs {.sidebar}
-----------------------------------------------------------------------

### Pick two counties

```{r}
selectInput("State1", "Choose a state:",
      full_data$state_name
    )

map_data1 <- reactive({
  filter(
  full_data,
  state_name == input$State
  )
}
)
```

```{r}
selectInput("State2", "Choose a state:",
      full_data$state_name
    )

map_data2 <- reactive({
  filter(
  full_data,
  state_name == input$State
  )
}
)
```



Row 1
------------

### County 1

* Information about county 1
```{r}
renderLeaflet(
  {
    factpal1 <- colorFactor(c("yellow", "green"), map_data1()$`Pollutant Grade`)
    
    leaflet(map_data1()) %>% 
      addTiles %>%
      addProviderTiles("Esri.WorldGrayCanvas") %>% 
      addPolygons(
        # data = shape,
        label = ~county_name,
        fillColor = ~ factpal1(map_data1()$`Pollutant Grade`),
        # layerId = ~COUNTYNS,
        opacity = 1,
        weight = 1,
        color = "white",
        dashArray = "3",
        fillOpacity = 0.5,
        popup = paste(
          "County:", map_data1()$county_name,"<br>",
          "Selected Grade:", map_data1()[[input$Grade]] ,"<br>",
          "Amount of People Who Commute In:", map_data1()$commute_into,"<br>",
          "Amount of People who Commute Out:", map_data1()$commute_out,"<br>",
          "Amount of People who Commute Within:", map_data1()$commute_within
          ),
        highlight = highlightOptions(
          weight = 5,
          color = "#666",
          dashArray = "",
          fillOpacity = 0.7,
          bringToFront = TRUE
          )
        ) %>% 
      addLegend(
        pal = factpal1, 
        values = ~`Pollutant Grade`, 
        opacity = 0.7, 
        title = NULL,
        position = "bottomright"
        )
  }
)
```

Row 2
------------

### County 2

* Information about county 2
```{r}
renderLeaflet(
  {
    factpal2 <- colorFactor(c("yellow", "green"), map_data2()$`Pollutant Grade`)
    
    leaflet(map_data2()) %>% 
      addTiles %>%
      addProviderTiles("Esri.WorldGrayCanvas") %>% 
      addPolygons(
        # data = shape,
        label = ~county_name,
        fillColor = ~ factpal2(map_data2()$`Pollutant Grade`),
        # layerId = ~COUNTYNS,
        opacity = 1,
        weight = 1,
        color = "white",
        dashArray = "3",
        fillOpacity = 0.5,
        popup = paste(
          "County:", map_data2()$county_name,"<br>",
          "Selected Grade:", map_data2()[[input$Grade]] ,"<br>",
          "Amount of People Who Commute In:", map_data2()$commute_into,"<br>",
          "Amount of People who Commute Out:", map_data2()$commute_out,"<br>",
          "Amount of People who Commute Within:", map_data2()$commute_within
          ),
        highlight = highlightOptions(
          weight = 5,
          color = "#666",
          dashArray = "",
          fillOpacity = 0.7,
          bringToFront = TRUE
          )
        ) %>% 
      addLegend(
        pal = factpal2, 
        values = ~`Pollutant Grade`, 
        opacity = 0.7, 
        title = NULL,
        position = "bottomright"
        )
    }
  )
    
```


Data
=====

## Row 1

### Data

<!-- ```{r} -->
<!-- knitr::kable(head(full_data)) -->
<!-- ``` -->



<!-- ```{r} -->
<!-- renderTable({ -->
<!--   head(full_data, n = 10) -->
<!-- }) -->
<!-- ``` -->


```{r}
DT::renderDataTable({
  data <- head(full_data, n = input$maxrows)
  DT::datatable(data, options = list(
    pageLength = 25 #bPaginate = FALSE
  ))
})
