---
title: "App Name Here"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    source_code: "https://github.com/cds490-top-fall20/air-quality"
runtime: shiny
---

```{r global, include=FALSE}
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(shiny))
suppressPackageStartupMessages(library(leaflet))
suppressPackageStartupMessages(library(sf))
suppressPackageStartupMessages(library(reshape2))
suppressPackageStartupMessages(library(leafpop))
suppressPackageStartupMessages(library(DT))
suppressPackageStartupMessages(library(flexdashboard))

full_data <- read_rds("../data/processed/counties_mapping_data_simplified.rds") %>% 
  filter(
    state_name == "Virginia"
  )
full_data
```


Map
===========

Inputs {.sidebar}
-----------------------------------------------------------------------

### Customize

```{r}
selectInput("state", "Choose a state:",
      list(`East Coast` = list("VA", "NJ", "CT"),
           `West Coast` = list("WA", "OR", "CA"),
           `Midwest` = list("MN", "WI", "IA"))
    )
```


```{r}
varSelectInput(
  "Grade", 
  "What grade would you like to View?", 
  tibble(
    "Pollutant Grade" = full_data$`Pollutant Grade`, 
    "Ozone Grade" = full_data$`Ozone Grade`,
    "Annual Pass/Fail" = full_data$`Annual Pass/Fail`
    )
  )
```


**Optional overlays**

```{r}
checkboxInput("inputId1", "Aiports", value = FALSE, width = NULL)
checkboxInput("inputId2", "Ports", value = FALSE, width = NULL)
checkboxInput("inputId", "Show metro areas", value = FALSE, width = NULL)
```



Row 1 {data-height=650}
-----------------------------------------------------------------------

### Map

```{r}

renderLeaflet(
  {
    factpal <- colorFactor(c("yellow", "green"), full_data$`Pollutant Grade`)
    
    leaflet(full_data) %>% 
      addProviderTiles("Esri.WorldGrayCanvas") %>% 
      addPolygons(
        # data = shape,
        label = ~county_name,
        fillColor = ~ factpal(full_data$`Pollutant Grade`),
        # layerId = ~COUNTYNS,
        opacity = 1,
        weight = 1,
        color = "white",
        dashArray = "3",
        fillOpacity = 0.5,
        popup = paste(
          "County:", full_data$county_name,"<br>",
          "Selected Grade:", full_data[[input$Grade]] ,"<br>",
          "Amount of People Who Commute In:", full_data$commute_into,"<br>",
          "Amount of People who Commute Out:", full_data$commute_out,"<br>",
          "Amount of People who Commute Within:", full_data$commute_within
          ),
        highlight = highlightOptions(
          weight = 5,
          color = "#666",
          dashArray = "",
          fillOpacity = 0.7,
          bringToFront = TRUE
          )
        ) %>% 
      addLegend(
        pal = factpal, 
        values = ~`Pollutant Grade`, 
        opacity = 0.7, 
        title = NULL,
        position = "bottomright"
        )
    }
  )
```


Row 2 {data-height=350}
-------


### <Name of Information Box>
    
Possible information to go here:

* county grades

* transportation emission statistics

* housing information

* commuting information
    
### Another box

Ideas for content:

* Glossary/definitions?
* About the dashboard/ about us
* Another visualization



Compare
========

Inputs {.sidebar}
-----------------------------------------------------------------------

### Pick two counties

```{r}
selectInput("state1", "Choose a state:",
      list(`East Coast` = list("Fairfax County", "NJ", "CT"),
           `West Coast` = list("WA", "OR", "CA"),
           `Midwest` = list("MN", "WI", "IA"))
    )
```

```{r}
selectInput("state2", "Choose a state:",
      list(`East Coast` = list("Arlington County", "NJ", "CT"),
           `West Coast` = list("WA", "OR", "CA"),
           `Midwest` = list("MN", "WI", "IA"))
    )
```

Row 1
------------

### County 1

* Information about county 1

Row 2
------------

### County 2

* Information about county 2


Data
=====


Inputs {.sidebar}
-----------------------------------------------------------------------

```{r}
selectInput("datatable_state", "Choose a state:",
      full_data$state_name
    )
```

## Row 1

### Data



```{r}
DT::renderDataTable({
  full_data %>%
    filter(state_name == input$datatable_state )%>%
    datatable()
})
```


